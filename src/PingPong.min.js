class PingPong{constructor(canvas,options){options=options||{},this.options=options,this.bot=options.bot?options.bot:"Bot",this.botVelocity=options.botVelocity?options.botVelocity:5,this.canvas=canvas,this.canvasOptions={x:0,y:0,w:options.canvas&&options.canvas.width?options.canvas.width:700,h:options.canvas&&options.canvas.height?options.canvas.height:400,color:options.canvas&&options.canvas.color?options.canvas.color:"#000",orientation:options.canvas&&options.canvas.orientation?options.canvas.orientation:"horizontal"},this.canvas.width=this.canvasOptions.w,this.canvas.height=this.canvasOptions.h,"vertical"==this.canvasOptions.orientation&&(this.canvas.style.transform="rotate(-90deg)"),this.ctx=this.canvas.getContext("2d"),this.userOptions={x:0,y:options.paddle&&options.paddle.height?this.canvas.height/2-options.paddle.height/2:this.canvas.height/2-50,w:options.paddle&&options.paddle.width?options.paddle.width:10,h:options.paddle&&options.paddle.height?options.paddle.height:100,score:0,color:options.paddle&&options.paddle.color?options.paddle.color:"#fff"},this.computerOptions={x:options.paddle&&options.paddle.width?this.canvas.width-options.paddle.width:this.canvas.width-10,y:options.paddle&&options.paddle.height?this.canvas.height/2-options.paddle.height/2:this.canvas.height/2-50,w:options.paddle&&options.paddle.width?options.paddle.width:10,h:options.paddle&&options.paddle.height?options.paddle.height:100,score:0,color:options.paddle&&options.paddle.color?options.paddle.color:"#fff"},this.ballOptions={x:this.canvas.width/2,y:this.canvas.height/2,r:options.ball&&options.ball.radius?options.ball.radius:10,color:options.ball&&options.ball.color?options.ball.color:"#ff0000",velocity:options.ball&&options.ball.velocity?options.ball.velocity:[5,5],speed:options.ball&&options.ball.speed?options.ball.speed>0?options.ball.speed:-options.ball.speed:5,acceleration:options.ball&&options.ball.acceleration?options.ball.acceleration:.1},this.netOptions={x:options.net&&options.net.width?this.canvas.width/2-options.net.width/2:this.canvas.width/2-1,y:0,w:options.net&&options.net.width?options.net.width:2,h:options.net&&options.net.height?options.net.height:10,space:options.net&&options.net.space?options.net.space:15,color:options.net&&options.net.color?options.net.color:"#fff"},this.scoresOptions={fontSize:options.scores&&options.scores.fontSize?options.scores.fontSize:32,fontFamily:options.scores&&options.scores.fontFamily?options.scores.fontFamily:"Consolas",color:options.scores&&options.scores.color?options.scores.color:"#fff"},this.userScoreOptions={x:this.canvas.width/4,y:this.canvas.height/5},this.computerScoreOptions={x:this.canvas.width/4*3,y:this.canvas.height/5},this.controlPaddle=options.controls?options.controls:["keyboard"],this.controlPaddle.includes("keyboard")&&window.addEventListener("keydown",e=>{38==e.keyCode||87==e.keyCode?this.userOptions.y=this.userOptions.y-5:40!=e.keyCode&&83!=e.keyCode||(this.userOptions.y=this.userOptions.y+5)}),this.controlPaddle.includes("mouse")&&this.canvas.addEventListener("mousemove",e=>{this.userOptions.y=e.clientY-this.userOptions.h/2-this.canvas.getBoundingClientRect().top}),this.controlPaddle.includes("touch")&&this.canvas.addEventListener("touchmove",e=>{var touch=e.touches[0]||e.changedTouches[0];this.userOptions.y=touch.pageX-this.userOptions.h/2-this.canvas.getBoundingClientRect().left})}init(){console.log("Game starting..."),this.animationFrame=requestAnimationFrame(()=>this.play())}pause(){cancelAnimationFrame(this.animationFrame)}reset(){return this.userOptions.score=0,this.computerOptions.score=0,this.ballReset(),!0}drawRect(x,y,w,h,color){this.ctx.fillStyle=color,this.ctx.fillRect(x,y,w,h)}drawCircle(x,y,r,color){this.ctx.fillStyle=color,this.ctx.beginPath(),this.ctx.arc(x,y,r,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill()}drawText(num,x,y,color){this.ctx.fillStyle=color,this.ctx.font=`${this.scoresOptions.fontSize}px ${this.scoresOptions.fontFamily}`,this.ctx.fillText(num,x,y)}drawNet(){for(let i=0;i<this.canvas.height;i+=this.netOptions.space)this.drawRect(this.netOptions.x,i,this.netOptions.w,this.netOptions.h,this.netOptions.color)}play(){this.update(),this.render(),this.animationFrame=requestAnimationFrame(()=>this.play())}render(){this.drawRect(this.canvasOptions.x,this.canvasOptions.y,this.canvasOptions.w,this.canvasOptions.h,this.canvasOptions.color),this.drawRect(this.userOptions.x,this.userOptions.y,this.userOptions.w,this.userOptions.h,this.userOptions.color),this.drawRect(this.computerOptions.x,this.computerOptions.y,this.computerOptions.w,this.computerOptions.h,this.computerOptions.color),this.drawNet(),this.drawCircle(this.ballOptions.x,this.ballOptions.y,this.ballOptions.r,this.ballOptions.color),this.drawText(this.userOptions.score,this.userScoreOptions.x,this.userScoreOptions.y,this.scoresOptions.color),this.drawText(this.computerOptions.score,this.computerScoreOptions.x,this.computerScoreOptions.y,this.scoresOptions.color)}update(){this.ballOptions.y+=this.ballOptions.velocity[1],this.ballOptions.x+=this.ballOptions.velocity[0],this.ballCollision(),this.botPaddle()}paddleCollision(ball,player){return ball.top=ball.y-ball.r,ball.bottom=ball.y+ball.r,ball.left=ball.x-ball.r,ball.right=ball.x+ball.r,player.top=player.y,player.bottom=player.y+player.h,player.left=player.x,player.right=player.x+player.w,ball.top<player.bottom&&ball.bottom>player.top&&ball.left<player.right&&ball.right>player.left}ballCollision(){(this.ballOptions.y+this.ballOptions.r>=this.canvas.height||this.ballOptions.y-this.ballOptions.r<=0)&&(this.ballOptions.velocity[1]=-this.ballOptions.velocity[1]);let playerSide=this.ballOptions.x>this.canvas.width/2?this.computerOptions:this.userOptions;if(this.paddleCollision(this.ballOptions,playerSide)){let collidePoint=this.ballOptions.y-(playerSide.y+playerSide.h/2);collidePoint/=playerSide.h/2;let angleRad=collidePoint*(Math.PI/4),direction=this.ballOptions.x<this.canvas.width/2?1:-1;this.ballOptions.velocity[0]=direction*(this.ballOptions.speed*Math.cos(angleRad)),this.ballOptions.velocity[1]=this.ballOptions.speed*Math.sin(angleRad),this.ballOptions.speed+=this.ballOptions.acceleration}this.ballOptions.x+this.ballOptions.r>this.canvas.width?(this.userOptions.score+=1,this.ballReset()):this.ballOptions.x-this.ballOptions.r<0&&(this.computerOptions.score+=1,this.ballReset())}ballReset(){this.ballOptions.x=this.canvas.width/2,this.ballOptions.y=this.canvas.height/2,this.ballOptions.speed=this.options.ball&&this.options.ball.speed?this.options.ball.speed>0?this.options.ball.speed:-this.options.ball.speed:5,this.ballOptions.velocity[0]=-this.ballOptions.velocity[0]}botPaddle(){"Bot"==this.bot?this.botEngine():"Random"==this.bot&&this.randomBot()}botEngine(){this.computerOptions.y=this.ballOptions.y-this.computerOptions.h/2}randomBot(){(this.computerOptions.y<=0||this.computerOptions.y>=this.canvas.height)&&(this.botVelocity=-this.botVelocity),this.computerOptions.y+=this.botVelocity}}